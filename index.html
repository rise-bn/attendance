<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Attendance Form</title>
<style>
:root {
  --font-family: 'Open Sans', sans-serif;
  --font-size-label: 14px;
  --font-size-input: 14px;
  --font-size-header: 22px;
  --color-background: #f6f7fa;
  --color-card-bg: #ffffff;
  --color-card-border: #dbdfe7;
  --color-card-shadow: rgba(99, 77, 255, 0.06);
  --color-header: #333;
  --color-label: #555;
  --color-input-border: #ccc;
  --color-input-text: #333;
  --color-focus-border: #5a4cc2;
  --color-btn-bg: #ff6d5a;
  --color-btn-text: #fff;
  --radius: 6px;
  --container-width: 440px;
}
body {
  font-family: var(--font-family);
  background-color: var(--color-background);
  display: flex;
  justify-content: center;
  padding: 32px;
}
form {
  background: var(--color-card-bg);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius);
  box-shadow: 0 4px 12px var(--color-card-shadow);
  padding: 24px;
  width: var(--container-width);
}
h1 {
  text-align: center;
  font-size: var(--font-size-header);
  color: var(--color-header);
  margin-bottom: 24px;
}
label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: var(--font-size-label);
}
input[type="text"],
select {
  width: 100%;
  padding: 10px;
  font-size: var(--font-size-input);
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  margin-bottom: 16px;
  box-sizing: border-box;
}
input:focus,
select:focus {
  outline: none;
  border-color: var(--color-focus-border);
  box-shadow: 0 0 4px var(--color-focus-border);
}
button[type="submit"], .btn-secondary {
  background-color: var(--color-btn-bg);
  color: var(--color-btn-text);
  border: none;
  padding: 12px;
  width: 100%;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: var(--font-size-input);
  cursor: pointer;
  margin-top: 8px;
}
button[type="submit"]:hover, .btn-secondary:hover {
  background-color: #e05343;
}
canvas {
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  margin-bottom: 8px;
  width: 100%;
}
</style>
</head>
<body>

<form id="attendanceForm">
  <h1>Attendance Form</h1>

  <label for="name">Full Name</label>
  <input type="text" id="name" name="name" placeholder="Enter your name" required>

  <label for="email">Email</label>
  <input type="text" id="email" name="email" placeholder="Enter your email" required>

  <label for="contact">Contact Number</label>
  <input type="text" id="contact" name="contact" placeholder="Enter your contact number" required>

  <label for="attendance">Attendance Status</label>
  <select id="attendance" name="attendance" required>
    <option value="" disabled selected>-- Select --</option>
    <option value="Present">Present</option>
    <option value="Absent">Absent</option>
  </select>

  <label for="signaturePad">Signature (Required)</label>
  <canvas id="signaturePad" width="400" height="150"></canvas>
  <button type="button" class="btn-secondary" onclick="clearSignature()">Clear Signature</button>
  <input type="hidden" id="signature" name="signature" required>

  <button type="submit">Submit</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script>
  const canvas = document.getElementById("signaturePad");
  const signaturePad = new SignaturePad(canvas);

  function clearSignature() {
    signaturePad.clear();
  }

  document.getElementById('attendanceForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // enforce required signature
    if (signaturePad.isEmpty()) {
      alert("Please provide your signature before submitting.");
      return;
    }

    // Force consistent PNG export (works same on PC & mobile)
    document.getElementById("signature").value = signaturePad.toDataURL("image/png");

    const formData = {
      name: document.getElementById('name').value,
      email: document.getElementById('email').value,
      contact: document.getElementById('contact').value,
      attendance: document.getElementById('attendance').value,
      signature: document.getElementById('signature').value,
      timestamp: new Date().toISOString()
    };

    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Submitting...';
    submitBtn.disabled = true;

    try {
      const response = await fetch("https://risetotop.app.n8n.cloud/webhook/attendance", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });

      if (response.ok) {
        alert("Attendance submitted successfully!");
        this.reset();
        signaturePad.clear();
      } else {
        alert("Error: " + response.status);
      }
    } catch (err) {
      alert("Submission failed: " + err.message);
    } finally {
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    }
  });
</script>

</body>
</html>
